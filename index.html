<!doctype html>
<html lang="en-US">
    <head>
        <title>Our Driveway</title>
        <meta name="title" content="Our Driveway">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-height, initial-scale=1">
    </head>
    <body>
        <div id="body-flex">
            <div class="container">
                <img src="latest_thumb.jpg" style="min-width: 100vw; max-width:100vw; max-height: 100vh;"/>
                <button onClick="togglePastSnapshots();">Past Snapshots</button>
            </div>
            <div id="snapshots-container"></div>
        </div>
        <script src="./jquery-3.6.0.min.js"></script>
        <script>
            var pastSnapshotsVisible = false;
            var pastSnapshotsString = "";
            function togglePastSnapshots(){
                if(pastSnapshotsVisible){
                    $('#snapshots-container').html("")
                } else {
                    $('#snapshots-container').html(pastSnapshotsString)
                }
                pastSnapshotsVisible=!pastSnapshotsVisible;
            }
            // console.log("Tyler playground")
            var lastSnapshot = "";
            function refreshSnapshots(){
                $.get( "snapshots/", function( data ) {
                    lines = data.split("\n")
                    var firstLink = true;
                    var linkCount = 0;
                    for(var i = 0; i < lines.length && linkCount < 20; ++i){
                        var line = lines[i]
                        if(line.match(/^.*href=.*$/)){
                            var snapshot_url = line.replaceAll(/^.*href="([^"]*)".*$/g,'$1').replace(/^\./,"snapshots");
                            if(snapshot_url === "/"){
                                continue;
                            }
                            ++linkCount;
                            if(firstLink){
                                firstLink=false;
                                if(lastSnapshot !== snapshot_url){
                                    console.log("snapshot changed! now it's: "+snapshot_url)
                                } else {
                                    break; //No need to reload, no new pictures
                                }
                                lastSnapshot=snapshot_url
                                console.log(snapshot_url)
                            }
                            pastSnapshotsString+="<img style='max-width:100vw;' src='"+snapshot_url+"'/img>\n";
                            // console.log(line.replaceAll(/^.*href="([^"]*)".*$/g,'$1'))
                        }
                    }
                });
            }
            refreshSnapshots()
            setInterval(refreshSnapshots,10000);
        </script>
    </body>
</html>
